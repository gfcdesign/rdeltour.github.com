<!DOCTYPE html>

<meta charset="utf-8">
<title>XProc at the heart of an ebook production framework</title>

<body>
  <section class="bg-dark">
    <h1  class="color1"><strong class="color4 block">XProc</strong> at the  <strong class="color4">♥</strong> of an <strong class="color4 block">ebook</strong>production framework</h1>
    <hr class="bc3"/>
              <p class="color3" style="font-size: 30px;  font-weight: bold">Romain Deltour</p>
              <p class="color2">XML Prague – February 9th 2013</p>
    <aside role="note">
      My name is Romain Deltour, and I'm going to talk about our experience of using XProc and other XML technologies at the heart of a modular eBook production tool.

      I'm a software developer and I work for the DAISY Consortium, a global not-profit organization working towards the best way to read and publish since the late 90ies. 
    </aside>
  </section>


  <!-- ============================== -->
  <!-- ==        Background       == -->
  <!-- ============================== -->
  
  <section>
    <figure class="quote">
    <blockquote>
      The DAISY Consortium envisions a world where people with print disabilities have <em>equal access</em> to information and knowledge, <em>without delay or additional expense.</em>
    </blockquote>
    <figcaption>
      <img class="bounceInLeft animated" style="background-color:white;" src="./images/daisy.svg" alt="DAISY Consortium logo" width="200"/>
      <a href="http://daisy.org" title="DAISY Consortium homepage">&nbsp;http://daisy.org&nbsp;</a>
    </figcaption>
    </figure>
    <aside role="note">
      <p>Before diving in the nitty gritty of the topic, let me first give a brief overview of the context.</p>
      <p>We're engaged in development of specifications, tools, and educational efforts. We developed several standards for Digital Talking Books, targeted primarily at print-disabled users. More recently, we've got closer to the IDPF and endorsed EPUB 3 as the recommended format for distributing accessible content.</p>
    </aside>
  </section>
  
  <section class="gallery dense bg3">
      <h3  class=" color5">Reading with ...</h3>
      <ul>
      <li>
      	<img class="fadeInLeft animated p1 bc4" style="
      	top: 100;
      	left: 100px;
      	" src="./images/Eye.jpg" width="230" height="138" alt="eys">
      </li>
      <li>
      	<img class="fadeInLeft animated p2 bc4" style="
      	top: 200px;
      	left: 500px;
      	      	" src="./images/Ear.jpg" width="183" height="250" alt="ears">
      	</li>
      <li>
      	<img class="fadeInLeft animated p3 bc4" style="
      	top: 380px;
      	left: 180px;
      	" src="./images/FingerBraille.jpg" width="242" height="161" alt="fingers">
      	</li>
      </ul>
      <aside role="note">
         As I said, we're focused on inclusive publishing; which means we target every reader, whether they read with eyes, ears or fingers.
      </aside>
  </section>

  <section class="dense gallery bg5">
      <h3 class="color3">On a variety of devices...</h3>
      <ul>
        <li>
          <img class="fadeIn animated p1 bc3" style="
        top: 120px;
        left: 10px;
        border-color: none;
        " src="./images/Hand_Bookeen.jpg" width="200" height="260" alt="Bookeen">
        </li>
        <li>
          <img class="fadeIn animated p2 bc3" style="
        top: 110px;
        left: 255px;
        " src="./images/Hands_iPad_iBooks.jpg" width="300" height="200" alt="iPad iBooks">
        </li>
        <li>
          <img class="fadeIn animated p3 bc3" style="
        top: 120px;
        left: 600px;
        " src="./images/Hand_Nook.jpg" width="180" height="210" alt="Nook">
        </li>
        <li>
          <img class="fadeIn animated p4 bc3" style="
        top: 380px;
        left: 540px;
        " src="./images/VictorReader.jpg" width="220" height="148" alt="VictorReader">
        </li>
        <li>
          <img class="fadeIn animated p5 bc3" style="
        top: 390px;
        left: 310px;
        " src="./images/Plextalk_PTR2.jpg" width="200" height="200" alt="PlexTalk">
        </li>
        <li>
          <img class="fadeIn animated p6 bc3" style="
        top: 390px;
        left: 50px;
        "  src="./images/Braille3.jpg" width="210" height="138" alt="Braille3">
        </li>
      </ul>
      <aside role="note">
        Being inclusive also means publishers have to deal with an ever increasing variety of platforms and devices.
      </aside>
  </section>
  
  <section class="bg2 dense">
    <h3 class="color4">Single-source publishing</h3>
    <div class="incremental">
      <img src="./images/single-source.png" height="400" style="position: absolute; top: 150px; left: 100px" alt="Convert from a single XML master document to a variety of output formats">
      <img src="./images/other-sources.png" height="400" style="position: absolute; top: 150px; left:100px" alt="However a variety of different input XML formats can be used.">
    </div>
    <aside role="note">
      The best approach to deal with this situation is typically to adopt a single-source publishing pattern (...) however in reality, publishers of access-enhanced material often have to re-publish content from different kind of formats.
    </aside>
  </section>

  <!-- ============================== -->
  <!-- ==       Modular System     == -->
  <!-- ============================== -->

  <section class="bg-light">
    <h2>A <strong class="color5">modular</strong> XML system</h2>
    <aside role="note">
      The DAISY Pipeline project intends to assist with the production of accessible content by providing cross-format converters and processing utilities.
      In a more down-to-earth language, we want to be able to convert from a variety of formats to other formats. Primarily XML, sometimes not. XML pipes in, XML pipes out. Perfect fit for XProc.
    </aside>
  </section>

  <section>
      <figure class="image">
        <!-- © SeeWeb on Flickr:
                http://www.flickr.com/photos/seeweb/6115445165/ -->
        <img src="./images/pipes.jpg" alt="A complex sytem of pipes">
        <figcaption>Maintain these pipelines ? ...sigh...</figcaption>
      </figure>
      <aside role="note">
        When used not only for one-shot scripts but as the core of a large system, we need to ensure the maintainability and scalability of the system. Would you want to be the plumber fixing this thing ? (*** showing pic of messy tubes***)
      </aside>
  </section>
  
  <section>
      <figure class="image">
        <img src="./images/lego-plumber.jpg" alt="Lego bricks in a Lego truck">
        <figcaption>Modules to the rescue!</figcaption>
      </figure>
      <aside role="note">
        Fortunately, as known for decades, modularization can help. We did a little plumbing to make our pipelines as modular as we could.
      </aside>
  </section>
  
  <section class="list bg-light">
    <h3 class="color5">Modules</h3>
    <ul>
      <li class="bg1" style="margin-right: 20px">No "static binding"</li>
      <li class="bg1" style="margin-right: 50px">Public components</li>
      <li class="bg1" style="margin-right: 30px">Encapsulation</li>
      <li class="bg1" style="margin-right: 0px">Dependency Management</li>
    </ul>
    <aside role="note">
      The basic principles are pretty simple.<br/>
      - Modules are not "statically bond" one to another; i.e. we do not want to rely on relative URIs.<br/>
      - Modules can declare public components (public URIs) and encapsulate private components (not accessible to other modules)<br/>
      - Modules can declare requirements to other modules<br/>
    </aside>
  </section>
  
  <section class="dense bg3">
    <h3>A module, concretely</h3>
    <figure class="code left">
      <figcaption>META-INF/catalog.xml</figcaption>
          <pre><code>&lt;catalog
  xmlns=&quot;urn:oasis:names:tc:entity:xmlns:xml:catalog&quot;&gt;
  &lt;uri name=&quot;http://www.daisy.org/mod/daisy3-to-epub3&quot;
       uri=&quot;../xml/xproc/daisy3-to-epub3.xpl&quot;/&gt;
&lt;/catalog&gt;</code></pre>      
    </figure>
    <figure class="code right">
      <figcaption>META-INF/MANIFEST.MF</figcaption>
          <pre><code>
Bundle-SymbolicName: org.daisy.pipeline.modules.daisy3-to-epub3
Bundle-Version: 1.0.0.SNAPSHOT
Require-Bundle: org.daisy.pipeline.modules.epub3-nav-utils,...</code></pre>      
    </figure>
    <aside role="note">
      Concretely, a module in our system is a ZIP container with two special files: an OASIS XML catalog declaring the module's public component URIs, and an OSGi MANIFEST declaring the module's metadata (ID, version, dependencies, etc.).
    </aside>
  </section>
  
  <section class="bg1">
    <h2 class="color3">A shared URI resolver <em class="color4">registers</em> the modules' catalogs</h2>
    <aside role="note">
      The middleware implements a shared URI resolver that keeps track of all the modules' catalogs, so that references to absolute URIs in another module can be resolved to the dependent modules' internals.
    </aside>
  </section>
  
  <!-- ============================== -->
  <!-- ==        Beyond XProc       == -->
  <!-- ============================== -->
  
  <section class="bg-dark">
    <h2 style="color: #fff"><strong class="color1">Beyond</strong> XProc...</h2>
    <aside role="note">
    </aside>
  </section>
  
  <section class="image">
      <figure>
        <!-- © SeeWeb on Flickr:
                http://www.flickr.com/photos/seeweb/6115445165/ -->
        <img src="./images/pipes.jpg" alt="a complex system of pipes">
        <figcaption>A complex system, we know, but...</figcaption>
      </figure>
      <aside role="note">
        As I said the system can be pretty complex.
      </aside>
  </section>
  
  <section class="image">
      <figure>
        <img src="./images/taps.jpg" alt="water taps">
        <figcaption style="text-align:right">a simple user interface!</figcaption>
      </figure>
      <aside role="note">
        But in the end, the user is only interested with the functional interface.<br/>
        I'm going to present how we extend XProc and sometimes hide its idiosyncrasies for a seamless integration in a user-oriented system.
      </aside>
  </section>
  
  <section class="bg4">
    <h2 class="color3">Users should only be aware of <em class="color2">top-level</em> scripts</h2>
    <aside role="note">
      First, not all or modules or even XProc scripts are intended to be directly manipulated by the user. Some modules only contain utilities, some scripts are only intermediary step implementations. We identify the user-oriented scripts by adding some package-level metadata (in the OASIS catalog, converted at build time in OSGi-metadata).
    </aside>
  </section>
  
  <section class="dense bg2">
    <h3>Adding user-friendly metadata</h3>
    <figure class="code">
      <figcaption>XProc</figcaption>
      <pre><code>&lt;p:documentation 
    xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
  &lt;h1 px:role=&quot;name&quot;&gt;DAISY 3 to EPUB 3&lt;/h1&gt;
  &lt;p px:role=&quot;desc&quot;&gt;Transforms a DAISY 3 publication
     into an EPUB 3 publication.&lt;/p&gt;
  &lt;p px:role=&quot;author maintainer&quot;&gt;Romain Deltour&lt;/p&gt;
  &lt;p&gt;See the &lt;a href=&quot;...&quot; px:role=&quot;homepage&quot;&gt;
      online documentation&lt;/a&gt;
  &lt;/p&gt;
&lt;/p:documentation&gt;</code></pre>
    </figure>
    <aside role="note">
      Additionally, we augment user-oriented XProc scripts with human- and machine-readable metadata.
      We use XProc's native 'p:documentation' element, congaing HTML with semantic annotations.
    </aside>
  </section>
  
  <section class="bg3">
    <h3>Typing the XProc signature</h3>
    <figure class="code">
      <figcaption>XProc</figcaption>
          <pre><code>&lt;p:input port=&quot;source&quot; <span   class="highlighted">px:media-type=&quot;text/xml&quot;</span>
         primary=&quot;true&quot; sequence=&quot;false&quot;&gt;
    ...
&lt;/p:input&gt;
&lt;p:option name=&quot;mediaoverlay&quot; <span class="highlighted">px:type=&quot;boolean&quot;</span>
          required=&quot;false&quot; select=&quot;&#x27;true&#x27;&quot; &gt;
    ...
&lt;/p:option&gt;</code></pre>      
    </figure>
    <aside role="note">
      Metadata is also used to add typing information to the XProc signature. This info is notably used in user interfaces, to create appropriate input widgets when configuring XProc jobs.
    </aside>
  </section>

  <section class="dense bg4">
    <h3 class="">Hiding idiosyncrasies</h3>
    <figure class="code"  style="margin-top: 1em; margin-bottom: 1em">
      <figcaption>Pipeline A</figcaption>
          <pre><code>&lt;p:declare-step&gt;
  &lt;p:input port=&quot;source&quot;/&gt;
  &lt;p:output port=&quot;result&quot; sequence=&quot;false&quot;/&gt;
      ...
&lt;/p:declare-step&gt;</code></pre>      
    </figure>
    <figure class="code" style="margin-top: 1em">
      <figcaption>Pipeline B</figcaption>
          <pre><code>&lt;p:declare-step&gt;
  &lt;p:input port=&quot;source&quot;/&gt;
  &lt;p:option name=&quot;result-uri&quot; required=&quot;true&quot;
            <span class="highlighted">px:output="result"</span>/&gt;
      ...
  &lt;p:store&gt;
    &lt;p:with-option name=&quot;href&quot; select=&quot;$result-uri&quot;/&gt;
  &lt;/p:store&gt;
&lt;/p:declare-step&gt;</code></pre>      
    </figure>    
    <aside role="note">
      In these two pipelines: the functionality exposed to the user is the same: we give a doc as input and receive a doc as output. The system has to understand that the intent of the option is to store a result, hence we annotate it with px:output="result".
    </aside>
  </section>
  
  <section class="list bg1">
    <h3 class="color4">Summary</h3>
    <ul>
      <li class="bg3" style="margin-right: 0px">Top-level scripts identification</li>
      <li class="bg3" style="margin-right: 50px">User-oriented Metadata</li>
      <li class="bg3" style="margin-right: 0px">Typed XProc signature</li>
      <li class="bg3" style="margin-right: 30px">Hidden idiosyncrasies</li>
    </ul>
  </section>
  
  <!-- ============================== -->
  <!-- ==   Tips & Best Practices  == -->
  <!-- ============================== -->
    
  <section class="bg-light">
    <h2><span class="block ">XProc</span> <strong class="color4">Tips</strong> &amp; <strong class="color4">Best practices</strong></h2>
    <aside role="note">
    </aside>
  </section>
  
  <section class="bg2">
    <h2 class="">Use <em class="color5">intermediary formats</em> <span style="font-size: 30px"><br/>(e.g. for fileset manipulations)</span></h2>
    <aside role="note">
    </aside>
  </section>
  
  <section class="dense bg4">
    <h3>A fileset format</h3>
    <figure class="code">
      <figcaption>Fileset</figcaption>
      <pre><code>&lt;d:fileset
      xmlns:d=&quot;http://www.daisy.org/ns/pipeline/data&quot;
      xml:base=&quot;file:///Users/me&quot;&gt;
  &lt;d:file href=&quot;mimetype&quot;/&gt;
  &lt;d:file href=&quot;META-INF/container.xml&quot;/&gt;
  &lt;d:file href=&quot;Content/package.opf&quot;
          media-type=&quot;application/oebps-package+xml&quot; /&gt;
  &lt;d:file href=&quot;Content/toc.ncx&quot;
          media-type=&quot;application/x-dtbncx+xml&quot;/&gt;
  &lt;d:file href=&quot;http://www.example.org/style.css&quot;
          media-type=&quot;text/css&quot;/&gt;
&lt;/d:fileset&gt;</code></pre>
    </figure>
    <aside role="note">
    </aside>
  </section>
  
  <section class="bg3 color4">
    <h2>Rely on <em style="color: #111">base URIs</em></h2>
    <aside role="note">
    </aside>
  </section>
  
  <section  class="bg2">
    <h2>Use XProc for <em class="color4">orchestration</em></h2>
    <aside role="note">
    </aside>
  </section>
  
  <section class="list bg-light">
    <h3 class="color4">Summary</h3>
    <ul>
      <li class="bg1" style="margin-right: 0px">Use intermediary formats</li>
      <li class="bg1" style="margin-right: 50px">Rely on base URIs</li>
      <li class="bg1" style="margin-right: 0px">Modularize the workflow</li>
      <li class="bg1" style="margin-right: 30px">Leverage the XML stack</li>
    </ul>
    <aside role="note">
    </aside>
  </section>

  <!-- ============================== -->
  <!-- ==        Closing           == -->
  <!-- ============================== -->
  <section class="list bg3">
    <h3>A wishlist</h3>
    <ul style="margin:0">
      <li>Native XPath functions</li>
      <li>Better Base URI manipulation</li>
      <li>Readable ports from XPath</li>
    </ul>
    <h2 class="color5" style="margin-top: 320px; text-align: center; font-family: ArchitectsDaughterRegular"><strong>Join the community!</strong></h2>
      <aside role="note">
      </aside>
  </section>
  
  <section class="final bg-dark">
    <h1 class="h1 color1"><strong>Thank You!</strong></h1>
    <footer class="bg-dark">
      <p class="color3"><a href="http://daisy.org/pipeline2" class="color3">http://daisy.org/pipeline2</a></p>
      <p class="color3"><a href="http://code.google.com/p/daisy-pipeline/" class="color3">http://code.google.com/p/daisy-pipeline/</a></p>
      <p class="color3"><a href="http://github.com/daisy-consortium/" class="color3">http://github.com/daisy-consortium/</a></p>
      <p class="color4"><i class="icon icon-envelope-alt"></i>&nbsp;rdeltour@gmail.com</p>
      <p class="color1"><i class="icon icon-twitter"></i>&nbsp;@rdeltour</p>
    </footer>
    <aside role="note">
    </aside>
  </section>

  <div id="progress-bar"></div>

  <link rel="stylesheet" href="./css/dz-core.css" type="text/css"/>
  <link rel="stylesheet" href="./css/animate.css" type="text/css"/>
  <link rel="stylesheet" href="./css/highlight-github-mod.css" type="text/css"/>
  <link rel="stylesheet" href="./css/font-awesome.min.css"/>
  <link rel="stylesheet" href="./css/slides.css" type="text/css"/>


  <script src="./js/dz-core.js"></script>
  <script src="./js/dz-helper.js"></script>
  <script src="./js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  
</body>